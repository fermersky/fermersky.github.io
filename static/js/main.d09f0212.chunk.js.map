{"version":3,"sources":["App.js","index.js"],"names":["Video","styled","video","App","stream","useRef","callAccepted","userVid","partnerVid","socket","onlineUsersToCall","useState","yourID","setYourID","users","setUsers","useEffect","navigator","mediaDevices","getUserMedia","audio","then","s","current","srcObject","io","emit","prompt","on","allUsersSocketEvent","yourIDSocketEvent","tryToCallSocketEvent","id","data","a","from","signalFromCaller","peer","Peer","initiator","trickle","config","iceServers","urls","username","credential","signal","to","signalFromPartner","console","log","Object","keys","map","key","onClick","startCalling","className","playsInline","ref","muted","autoPlay","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"+VAQA,IAAMA,E,MAAQC,EAAOC,MAAV,KA6IIC,MAzIf,WACE,IAAMC,EAASC,mBACTC,EAAeD,kBAAO,GAEtBE,EAAUF,mBACVG,EAAaH,mBACbI,EAASJ,mBACTK,EAAoBL,mBAPb,EASeM,qBATf,mBASNC,EATM,KASEC,EATF,OAUaF,qBAVb,mBAUNG,EAVM,KAUCC,EAVD,KAcbC,qBAAU,WACRC,UAAUC,aAAaC,aAAa,CAAEjB,OAAO,EAAMkB,OAAO,IAAQC,MAAK,SAACC,GAClEf,EAAQgB,UACVhB,EAAQgB,QAAQC,UAAYF,EAC5BlB,EAAOmB,QAAUD,MAIrBb,EAAOc,QAAUE,IAAG,+CAEpBhB,EAAOc,QAAQG,KAAK,QAASC,OAAO,6BACpClB,EAAOc,QAAQK,GAAG,WAAYC,GAC9BpB,EAAOc,QAAQK,GAAG,SAAUE,GAC5BrB,EAAOc,QAAQK,GAAG,YAAaG,KAC9B,IAEH,IAAMF,EAAsB,SAACf,GAC3BC,EAASD,IAGLgB,EAAoB,SAACE,GACzBnB,EAAUmB,IAGND,EAAoB,uCAAG,WAAOE,GAAP,mBAAAC,EAAA,sDACnBC,EAA2BF,EAA3BE,KAAMC,EAAqBH,EAArBG,kBAERC,EAAO,IAAIC,IAAK,CACpBC,WAAW,EACXC,SAAS,EACTpC,OAAQA,EAAOmB,QACfkB,OAAQ,CACNC,WAAY,CACV,CACEC,KAAM,wBACNC,SAAU,uBACVC,WAAY,YAEd,CACEF,KAAM,wBACNC,SAAU,uBACVC,WAAY,iBAMfjB,GAAG,UAAU,SAACkB,GACjBrC,EAAOc,QAAQG,KAAK,aAAc,CAAEqB,GAAIZ,EAAMa,kBAAmBF,OAGnET,EAAKT,GAAG,UAAU,SAACK,GACjBzB,EAAWe,QAAQC,UAAYS,EAC/BgB,QAAQC,IAAI,sBAAwBjB,MAGtCI,EAAKS,OAAOV,GAhCe,2CAAH,sDAsF1B,OAZItB,IACFJ,EAAkBa,QAAU4B,OAAOC,KAAKtC,GAAOuC,KAAI,SAACrB,GAClD,OACEA,IAAOpB,GACL,wBAAI0C,IAAKtB,GACP,4BAAQuB,QAAS,kBA5CN,SAACvB,GACpB,IAAMK,EAAO,IAAIC,IAAK,CACpBC,WAAW,EACXC,SAAS,EACTC,OAAQ,CACNC,WAAY,CACV,CACEC,KAAM,wBACNC,SAAU,uBACVC,WAAY,YAEd,CACEF,KAAM,wBACNC,SAAU,uBACVC,WAAY,cAIlBzC,OAAQA,EAAOmB,UAGjBc,EAAKT,GAAG,UAAU,SAACK,GACZ3B,EAAaiB,SAChBd,EAAOc,QAAQG,KAAK,OAAQ,CAAES,KAAMvB,EAAQmC,GAAIf,EAAII,iBAAkBH,OAI1EI,EAAKT,GAAG,UAAU,SAACK,GACjBzB,EAAWe,QAAQC,UAAYS,EAC/BgB,QAAQC,IAAI,uBAAyBjB,MAGvCxB,EAAOc,QAAQK,GAAG,gBAAgB,SAACoB,GACjCX,EAAKS,OAAOE,GAEZ1C,EAAaiB,SAAU,KASMiC,CAAaxB,KAApC,WAAkDlB,EAAMkB,SAQhE,yBAAKyB,UAAU,OACb,6BACE,kBAACzD,EAAD,CAAO0D,aAAW,EAACC,IAAKpD,EAASqD,OAAK,EAACC,UAAQ,IAC/C,kBAAC7D,EAAD,CAAO0D,aAAW,EAACC,IAAKnD,EAAYqD,UAAQ,KAE9C,6BACE,4BAAKnD,EAAkBa,YC1I/BuC,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,EAAD,OAEFC,SAASC,eAAe,U","file":"static/js/main.d09f0212.chunk.js","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\n\nimport Peer from 'simple-peer';\nimport io from 'socket.io-client';\nimport styled from 'styled-components';\n\nimport servers from './ices';\n\nconst Video = styled.video`\n  width: 400px;\n`;\n\nfunction App() {\n  const stream = useRef();\n  const callAccepted = useRef(false);\n\n  const userVid = useRef();\n  const partnerVid = useRef();\n  const socket = useRef();\n  const onlineUsersToCall = useRef();\n\n  const [yourID, setYourID] = useState();\n  const [users, setUsers] = useState();\n  // const [callAccepted, setCallAccepted] = useState(false);\n  // const [stream, setStream] = useState();\n\n  useEffect(() => {\n    navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then((s) => {\n      if (userVid.current) {\n        userVid.current.srcObject = s;\n        stream.current = s;\n      }\n    });\n\n    socket.current = io('https://tranquil-inlet-70924.herokuapp.com/');\n\n    socket.current.emit('enter', prompt('What is your name, hero?'));\n    socket.current.on('allUsers', allUsersSocketEvent);\n    socket.current.on('yourID', yourIDSocketEvent);\n    socket.current.on('tryToCall', tryToCallSocketEvent);\n  }, []);\n\n  const allUsersSocketEvent = (users) => {\n    setUsers(users);\n  };\n\n  const yourIDSocketEvent = (id) => {\n    setYourID(id);\n  };\n\n  const tryToCallSocketEvent = async (data) => {\n    const { from, signalFromCaller } = data;\n\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream: stream.current,\n      config: {\n        iceServers: [\n          {\n            urls: 'stun:numb.viagenie.ca',\n            username: 'sultan1640@gmail.com',\n            credential: '98376683',\n          },\n          {\n            urls: 'turn:numb.viagenie.ca',\n            username: 'sultan1640@gmail.com',\n            credential: '98376683',\n          },\n        ],\n      },\n    });\n\n    peer.on('signal', (signal) => {\n      socket.current.emit('acceptCall', { to: from, signalFromPartner: signal });\n    });\n\n    peer.on('stream', (data) => {\n      partnerVid.current.srcObject = data;\n      console.log('recived from caller' + data);\n    });\n\n    peer.signal(signalFromCaller);\n  };\n\n  const startCalling = (id) => {\n    const peer = new Peer({\n      initiator: true,\n      trickle: false,\n      config: {\n        iceServers: [\n          {\n            urls: 'stun:numb.viagenie.ca',\n            username: 'sultan1640@gmail.com',\n            credential: '98376683',\n          },\n          {\n            urls: 'turn:numb.viagenie.ca',\n            username: 'sultan1640@gmail.com',\n            credential: '98376683',\n          },\n        ],\n      },\n      stream: stream.current,\n    });\n\n    peer.on('signal', (data) => {\n      if (!callAccepted.current) {\n        socket.current.emit('call', { from: yourID, to: id, signalFromCaller: data });\n      }\n    });\n\n    peer.on('stream', (data) => {\n      partnerVid.current.srcObject = data;\n      console.log('recived from partner' + data);\n    });\n\n    socket.current.on('callAccepted', (signalFromPartner) => {\n      peer.signal(signalFromPartner);\n\n      callAccepted.current = true;\n    });\n  };\n\n  if (users) {\n    onlineUsersToCall.current = Object.keys(users).map((id) => {\n      return (\n        id !== yourID && (\n          <li key={id}>\n            <button onClick={() => startCalling(id)}>Call to {users[id]}</button>\n          </li>\n        )\n      );\n    });\n  }\n\n  return (\n    <div className='App'>\n      <div>\n        <Video playsInline ref={userVid} muted autoPlay />\n        <Video playsInline ref={partnerVid} autoPlay />\n      </div>\n      <div>\n        <ul>{onlineUsersToCall.current}</ul>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}