{"version":3,"sources":["ices.js","App.js","index.js"],"names":["url","credential","username","Video","styled","video","App","stream","useRef","callAccepted","userVid","partnerVid","socket","onlineUsersToCall","useState","yourID","setYourID","users","setUsers","useEffect","navigator","mediaDevices","getUserMedia","audio","then","s","current","srcObject","io","emit","prompt","on","allUsersSocketEvent","yourIDSocketEvent","tryToCallSocketEvent","id","data","a","console","log","from","signalFromCaller","peer","Peer","initiator","trickle","config","iceServers","servers","signal","to","signalFromPartner","Object","keys","map","key","onClick","startCalling","className","playsInline","ref","muted","autoPlay","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"+QAAe,GACb,CAAEA,IAAK,2BACP,CAAEA,IAAK,2BACP,CACEA,IAAK,wBACLC,WAAY,SACZC,SAAU,mBAEZ,CACEF,IAAK,wCACLC,WAAY,+BACZC,SAAU,wB,wFCHd,IAAMC,EAAQC,IAAOC,MAAV,KAwHIC,MApHf,WACE,IAAMC,EAASC,mBACTC,EAAeD,kBAAO,GAEtBE,EAAUF,mBACVG,EAAaH,mBACbI,EAASJ,mBACTK,EAAoBL,mBAPb,EASeM,qBATf,mBASNC,EATM,KASEC,EATF,OAUaF,qBAVb,mBAUNG,EAVM,KAUCC,EAVD,KAcbC,qBAAU,WACRC,UAAUC,aAAaC,aAAa,CAAEjB,OAAO,EAAMkB,OAAO,IAAQC,MAAK,SAACC,GAClEf,EAAQgB,UACVhB,EAAQgB,QAAQC,UAAYF,EAC5BlB,EAAOmB,QAAUD,MAIrBb,EAAOc,QAAUE,IAAG,+CAEpBhB,EAAOc,QAAQG,KAAK,QAASC,OAAO,6BACpClB,EAAOc,QAAQK,GAAG,WAAYC,GAC9BpB,EAAOc,QAAQK,GAAG,SAAUE,GAC5BrB,EAAOc,QAAQK,GAAG,YAAaG,KAC9B,IAEH,IAAMF,EAAsB,SAACf,GAC3BC,EAASD,IAGLgB,EAAoB,SAACE,GACzBnB,EAAUmB,IAGND,EAAoB,uCAAG,WAAOE,GAAP,mBAAAC,EAAA,sDAC3BC,QAAQC,IAAIhC,GACJiC,EAA2BJ,EAA3BI,KAAMC,EAAqBL,EAArBK,kBAERC,EAAO,IAAIC,IAAK,CACpBC,WAAW,EACXC,SAAS,EACTtC,OAAQA,EAAOmB,QACfoB,OAAQ,CACNC,WAAYC,MAIXjB,GAAG,UAAU,SAACkB,GACjBrC,EAAOc,QAAQG,KAAK,aAAc,CAAEqB,GAAIV,EAAMW,kBAAmBF,OAGnEP,EAAKX,GAAG,UAAU,SAACK,GACjBzB,EAAWe,QAAQC,UAAYS,KAGjCM,EAAKO,OAAOR,GArBe,2CAAH,sDAiE1B,OAZIxB,IACFJ,EAAkBa,QAAU0B,OAAOC,KAAKpC,GAAOqC,KAAI,SAACnB,GAClD,OACEA,IAAOpB,GACL,wBAAIwC,IAAKpB,GACP,4BAAQqB,QAAS,kBAlCN,SAACrB,GACpBG,QAAQC,IAAIhC,EAAOmB,SAEnB,IAAMgB,EAAO,IAAIC,IAAK,CACpBC,WAAW,EACXC,SAAS,EACTC,OAAQ,CACNC,WAAYC,GAEdzC,OAAQA,EAAOmB,UAGjBgB,EAAKX,GAAG,UAAU,SAACK,GACZ3B,EAAaiB,SAChBd,EAAOc,QAAQG,KAAK,OAAQ,CAAEW,KAAMzB,EAAQmC,GAAIf,EAAIM,iBAAkBL,OAI1EM,EAAKX,GAAG,UAAU,SAACK,GACjBzB,EAAWe,QAAQC,UAAYS,KAGjCxB,EAAOc,QAAQK,GAAG,gBAAgB,SAACoB,GACjCT,EAAKO,OAAOE,GAEZ1C,EAAaiB,SAAU,KASM+B,CAAatB,KAApC,WAAkDlB,EAAMkB,SAQhE,yBAAKuB,UAAU,OACb,6BACE,kBAACvD,EAAD,CAAOwD,aAAW,EAACC,IAAKlD,EAASmD,OAAK,EAACC,UAAQ,IAC/C,kBAAC3D,EAAD,CAAOwD,aAAW,EAACC,IAAKjD,EAAYmD,UAAQ,KAE9C,6BACE,4BAAKjD,EAAkBa,YCrH/BqC,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,EAAD,OAEFC,SAASC,eAAe,U","file":"static/js/main.0a9466fb.chunk.js","sourcesContent":["export default [\r\n  { url: 'stun:stun.voipstunt.com' },\r\n  { url: 'stun:stun.voxgratia.org' },\r\n  {\r\n    url: 'turn:numb.viagenie.ca',\r\n    credential: 'muazkh',\r\n    username: 'webrtc@live.com',\r\n  },\r\n  {\r\n    url: 'turn:192.158.29.39:3478?transport=udp',\r\n    credential: 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',\r\n    username: '28224511:1379330808',\r\n  },\r\n];\r\n","import React, { useEffect, useRef, useState } from 'react';\n\nimport Peer from 'simple-peer';\nimport io from 'socket.io-client';\nimport styled from 'styled-components';\n\nimport servers from './ices';\n\nconst Video = styled.video`\n  width: 400px;\n`;\n\nfunction App() {\n  const stream = useRef();\n  const callAccepted = useRef(false);\n\n  const userVid = useRef();\n  const partnerVid = useRef();\n  const socket = useRef();\n  const onlineUsersToCall = useRef();\n\n  const [yourID, setYourID] = useState();\n  const [users, setUsers] = useState();\n  // const [callAccepted, setCallAccepted] = useState(false);\n  // const [stream, setStream] = useState();\n\n  useEffect(() => {\n    navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then((s) => {\n      if (userVid.current) {\n        userVid.current.srcObject = s;\n        stream.current = s;\n      }\n    });\n\n    socket.current = io('https://tranquil-inlet-70924.herokuapp.com/');\n\n    socket.current.emit('enter', prompt('What is your name, hero?'));\n    socket.current.on('allUsers', allUsersSocketEvent);\n    socket.current.on('yourID', yourIDSocketEvent);\n    socket.current.on('tryToCall', tryToCallSocketEvent);\n  }, []);\n\n  const allUsersSocketEvent = (users) => {\n    setUsers(users);\n  };\n\n  const yourIDSocketEvent = (id) => {\n    setYourID(id);\n  };\n\n  const tryToCallSocketEvent = async (data) => {\n    console.log(stream);\n    const { from, signalFromCaller } = data;\n\n    const peer = new Peer({\n      initiator: false,\n      trickle: true,\n      stream: stream.current,\n      config: {\n        iceServers: servers,\n      },\n    });\n\n    peer.on('signal', (signal) => {\n      socket.current.emit('acceptCall', { to: from, signalFromPartner: signal });\n    });\n\n    peer.on('stream', (data) => {\n      partnerVid.current.srcObject = data;\n    });\n\n    peer.signal(signalFromCaller);\n  };\n\n  const startCalling = (id) => {\n    console.log(stream.current);\n\n    const peer = new Peer({\n      initiator: true,\n      trickle: true,\n      config: {\n        iceServers: servers,\n      },\n      stream: stream.current,\n    });\n\n    peer.on('signal', (data) => {\n      if (!callAccepted.current) {\n        socket.current.emit('call', { from: yourID, to: id, signalFromCaller: data });\n      }\n    });\n\n    peer.on('stream', (data) => {\n      partnerVid.current.srcObject = data;\n    });\n\n    socket.current.on('callAccepted', (signalFromPartner) => {\n      peer.signal(signalFromPartner);\n\n      callAccepted.current = true;\n    });\n  };\n\n  if (users) {\n    onlineUsersToCall.current = Object.keys(users).map((id) => {\n      return (\n        id !== yourID && (\n          <li key={id}>\n            <button onClick={() => startCalling(id)}>Call to {users[id]}</button>\n          </li>\n        )\n      );\n    });\n  }\n\n  return (\n    <div className='App'>\n      <div>\n        <Video playsInline ref={userVid} muted autoPlay />\n        <Video playsInline ref={partnerVid} autoPlay />\n      </div>\n      <div>\n        <ul>{onlineUsersToCall.current}</ul>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}